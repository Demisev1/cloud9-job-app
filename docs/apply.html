<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Apply â€¢ Cloud 9 Jobs</title><link rel="stylesheet" href="style.css"><script src="config.js"></script><script src="api.js"></script></head>
<body>
<header><h1>Apply at Cloud 9</h1><nav><a href="index.html">Home</a> <a href="login.html">Login</a> <a href="admin.html">Admin</a></nav></header>

<div class="card">
  <h2>Open Locations</h2>
  <p><select id="location"><option value="">Loading...</option></select></p>
</div>

<div class="card">
  <h2>Application</h2>
  <div class="row">
    <div><label>Full name<br><input id="full_name" placeholder="Your name"></label></div>
    <div><label>Email<br><input id="email" type="email" placeholder="you@example.com"></label></div>
  </div>
  <div class="row">
    <div><label>Phone<br><input id="phone" placeholder="(###) ###-####"></label></div>
    <div><label>Position<br><input id="position" placeholder="Sales Associate"></label></div>
  </div>
  <label>Resume URL (optional)<br><input id="resume_url" placeholder="https://..."></label>
  <label>Cover letter (optional)<br><textarea id="cover_letter" rows="5" placeholder="Tell us about yourself..."></textarea></label>
  <p><button id="submitBtn">Submit Application</button></p>
  <p id="msg"></p>
</div>

<div class="card">
  <h2>My Applications</h2>
  <div id="mine"></div>
</div>

<script>
async function loadLocations(){
  try {
    const locs = await api('/locations');
    const sel = document.getElementById('location');
    sel.innerHTML = '<option value="">Select a location</option>' + locs.map(l => 
      `<option value="${l.id}">${l.name} ${l.city?(' - '+l.city):''}</option>`).join('');
  } catch(e) { document.getElementById('msg').textContent = fmtErr(e); }
}
async function loadMine(){
  try {
    const rows = await api('/applications/mine');
    const root = document.getElementById('mine');
    if (!rows.length) { root.innerHTML = '<p>No applications yet.</p>'; return; }
    root.innerHTML = '<table class="table"><thead><tr><th>ID</th><th>Position</th><th>Location</th><th>Status</th><th>Created</th></tr></thead><tbody>' +
      rows.map(r => `<tr><td>${r.id}</td><td>${r.position||''}</td><td>${r.location_id||''}</td><td><span class="badge">${r.status}</span></td><td>${r.created_at}</td></tr>`).join('') +
      '</tbody></table>';
  } catch(e){ document.getElementById('mine').innerHTML = '<p>'+fmtErr(e)+'</p>'; }
}
document.getElementById('submitBtn').onclick = async () => {
  const body = {
    full_name: document.getElementById('full_name').value.trim(),
    email: document.getElementById('email').value.trim(),
    phone: document.getElementById('phone').value.trim(),
    location_id: document.getElementById('location').value || null,
    position: document.getElementById('position').value.trim(),
    resume_url: document.getElementById('resume_url').value.trim(),
    cover_letter: document.getElementById('cover_letter').value
  };
  try {
    await api('/applications', { method:'POST', body: JSON.stringify(body) });
    document.getElementById('msg').textContent = 'Submitted!';
    await loadMine();
  } catch(e){ document.getElementById('msg').textContent = fmtErr(e); }
};
loadLocations(); loadMine();
</script>
</body></html>
