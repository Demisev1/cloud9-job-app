<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Apply — Cloud 9 Vapes / The Hemp and Kratom Depot</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script src="https://www.google.com/recaptcha/api.js?render=6LeMDbsrAAAAAKpwpF8t9Rjua34eDicplvmxS1fo"></script>
<style>
  :root{
    --text:#0f172a; --muted:#64748b; --card:#ffffff; --radius:16px; --border:#e5e7eb;
    --input:#ffffff; --accent:#2563eb; --accent-2:#60a5fa; --accent-soft: rgba(37,99,235,.12);
    --card-tint:#f6f9ff; --bg-a:#f7fbff; --bg-b:#eef5ff; --bg-splotch-1: rgba(37,99,235,.10); --bg-splotch-2: rgba(96,165,250,.08);
  }
  *{box-sizing:border-box}
  body{
    margin:0;font-family:'Inter',ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,Noto Sans;color:var(--text);
    background:radial-gradient(900px 480px at -10% -10%, var(--bg-splotch-1), transparent 60%),
               radial-gradient(800px 460px at 110% -10%, var(--bg-splotch-2), transparent 60%),
               linear-gradient(180deg, var(--bg-a) 0%, var(--bg-b) 100%);
  }
  header.hero{padding:28px 16px 6px;text-align:center}
  .hero-inner{max-width:1100px;margin:0 auto}
  .brand-logo{height:clamp(110px,18vw,190px);width:auto;display:block;margin:0 auto;background:#fff;border:1px solid var(--border);border-radius:16px;padding:12px;box-shadow:0 12px 30px rgba(15,23,42,.08)}
  h1{margin:12px 0 8px;font-size:clamp(30px,3.6vw,44px)}
  .container{max-width:1000px;margin:10px auto 56px;padding:0 16px}
  .card{background:linear-gradient(180deg,var(--card),var(--card-tint));border:1px solid var(--border);border-radius:16px;box-shadow:0 12px 40px rgba(2,6,23,.06);overflow:hidden}
  .bar{height:5px;background:linear-gradient(90deg,var(--accent),var(--accent-2))}
  .form{padding:22px}
  #progressWrap{height:8px;background:#e5e7eb;border-radius:999px;overflow:hidden;margin:10px 0 20px}
  #progressBar{height:100%;width:33%;background:linear-gradient(90deg,var(--accent),var(--accent-2));transition:width .25s}
  fieldset{border:1px solid var(--border);border-radius:12px;padding:16px;margin:18px 0;background:#fff}
  legend{padding:0 8px;color:#0f172a;opacity:.9;font-weight:800}
  label{display:block;margin:10px 0 6px}
  .row{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
  input[type=text],input[type=email],input[type=tel],input[type=date],select,textarea{width:100%;padding:12px;border-radius:12px;border:1px solid #d1d5db;background:#fff;color:var(--text);outline:none;transition:border-color .15s,box-shadow .15s}
  input:focus,select:focus,textarea:focus{border-color:var(--accent);box-shadow:0 0 0 .22rem var(--accent-soft)}
  textarea{min-height:110px;resize:vertical}
  .radio-group label{display:flex;align-items:center;gap:8px;margin:6px 0}
  .hint{color:#64748b;font-size:13px}
  .req{color:#ef4444}
  input[type=checkbox],input[type=radio]{accent-color:var(--accent)}
  .actions{display:flex;gap:10px;justify-content:space-between;align-items:center;margin-top:14px;flex-wrap:wrap}
  .actions-right{display:flex;gap:10px;align-items:center;margin-left:auto}
  .btn{border:none;border-radius:12px;padding:12px 18px;font-weight:800;cursor:pointer}
  .btn.primary{color:#fff;background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:0 8px 18px var(--accent-soft)}
  .btn.ghost{background:#f3f4f6;color:#111827;border:1px solid #e5e7eb}
  .status{min-height:22px;font-size:14px;color:#075985}
  .success{padding:26px;text-align:center}
  .success h2{margin:0 0 8px;font-size:clamp(22px,3vw,30px)}
  .success p{color:#334155}
  footer{color:#6b7280;text-align:center;padding:18px 12px 42px}
  .step{display:none} .step.active{display:block}
</style>
</head>
<body>
<header class="hero">
  <div class="hero-inner">
    <img id="brandLogo" class="brand-logo" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MDAiIGhlaWdodD0iMjgwIj4KICA8ZGVmcz4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iZyIgeDE9IjAiIHkxPSIwIiB4Mj0iMSIgeTI9IjEiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiMyNTYzZWIiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjNjBhNWZhIi8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPGZpbHRlciBpZD0ic2hhZG93IiB4PSItMjAlIiB5PSItMjAlIiB3aWR0aD0iMTQwJSIgaGVpZ2h0PSIxNDAlIj4KICAgICAgPGZlRHJvcFNoYWRvdyBkeD0iMCIgZHk9IjYiIHN0ZERldmlhdGlvbj0iNiIgZmxvb2QtY29sb3I9IiMwMDAiIGZsb29kLW9wYWNpdHk9Ii4yIi8+CiAgICA8L2ZpbHRlcj4KICA8L2RlZnM+CiAgPHJlY3QgeD0iMTIiIHk9IjEyIiB3aWR0aD0iODc2IiBoZWlnaHQ9IjI1NiIgcng9IjI0IiBmaWxsPSJ1cmwoI2cpIiBmaWx0ZXI9InVybCgjc2hhZG93KSIvPgogIDx0ZXh0IHg9IjUwJSIgeT0iNDglIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iSW50ZXIsU2Vnb2UgVUksQXJpYWwiIGZvbnQtd2VpZ2h0PSI4MDAiIGZvbnQtc2l6ZT0iNjgiIGZpbGw9IiNmZmYiPkNsb3VkIDkgVmFwZXM8L3RleHQ+CiAgPHRleHQgeD0iNTAlIiB5PSI3NiUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJJbnRlcixTZWdvZSBVSSxBcmlhbCIgZm9udC13ZWlnaHQ9IjYwMCIgZm9udC1zaXplPSIzOCIgZmlsbD0iI2U4ZjFmZiI+QXBwbHkgTm93PC90ZXh0Pgo8L3N2Zz4=" alt="Company logo">
    <h1>Join the Team</h1>
  </div>
</header>

<main class="container">
  <section class="card" id="formCard">
    <div class="bar"></div>
    <div class="form">
      <div id="progressWrap"><div id="progressBar"></div></div>
      <form id="applicationForm" novalidate>
        <input id="hp" name="hp" type="text" style="position:absolute;left:-10000px;opacity:0" tabindex="-1" autocomplete="off" aria-hidden="true">

        <!-- STEP 1 -->
        <div class="step active" data-step="1">
          <fieldset>
            <legend>Company & Location</legend>
            <div class="row">
              <div>
                <label for="company">Company <span class="req">*</span></label>
                <select id="company" name="company" required>
                  <option value="">-- Select Company --</option>
                  <option value="Cloud 9 Vapes">Cloud 9 Vapes</option>
                  <option value="The Hemp and Kratom Depot">The Hemp and Kratom Depot</option>
                </select>
              </div>
              <div>
                <label for="start_date">Earliest Start Date <span class="req">*</span></label>
                <input type="date" id="start_date" name="start_date" required>
              </div>
            </div>
            <div id="locationsContainer" style="display:grid;gap:8px;margin-top:10px"></div>
          </fieldset>

          <fieldset>
            <legend>Personal Information</legend>
            <div class="row">
              <div><label for="first_name">First Name <span class="req">*</span></label><input type="text" id="first_name" name="first_name" required></div>
              <div><label for="last_name">Last Name <span class="req">*</span></label><input type="text" id="last_name" name="last_name" required></div>
              <div><label for="email">Email <span class="req">*</span></label><input type="email" id="email" name="email" required></div>
              <div><label for="phone">Phone <span class="req">*</span></label><input type="tel" id="phone" name="phone" required></div>
              <div><label for="birthdate">Birthdate (must be 21+) <span class="req">*</span></label><input type="date" id="birthdate" name="birthdate" required></div>
            </div>
          </fieldset>
        </div>

        <!-- STEP 2 -->
        <div class="step" data-step="2">
          <fieldset>
            <legend>Position</legend>
            <label for="position">Position Applying For <span class="req">*</span></label>
            <input type="text" id="position" name="position" required>
            <div class="radio-group" style="margin-top:8px;">
              <p><b>Which best describes the position you are looking for?</b> <span class="req">*</span></p>
              <label><input type="radio" name="position_type" value="Full time" required> Full time</label>
              <label><input type="radio" name="position_type" value="Part time"> Part time</label>
              <label><input type="radio" name="position_type" value="Over Nights"> Over Nights</label>
              <label><input type="radio" name="position_type" value="Any available position"> Any available position</label>
            </div>
          </fieldset>

          <fieldset>
            <legend>Availability & Scheduling <span class="req">*</span></legend>
            <p class="hint">Cloud 9 Vapes is open 7 days a week, and the Hillcrest, Daphne and D'Iberville locations remain open overnight. Are there any days or shifts you cannot work or would be unwilling to work? If so, please elaborate.</p>
            <textarea id="availability_limits" name="availability_limits" rows="4" required placeholder="e.g., Can't work Tuesdays after 6pm; no overnights"></textarea>
          </fieldset>

          <fieldset>
            <legend>About You <span class="req">*</span></legend>
            <div class="radio-group">
              <label><input type="radio" name="use_profile" value="I currently vape" required> I currently vape</label>
              <label><input type="radio" name="use_profile" value="I currently smoke"> I currently smoke</label>
              <label><input type="radio" name="use_profile" value="I am a dual user (vape and smoke)"> I am a dual user (vape and smoke)</label>
              <label><input type="radio" name="use_profile" value="I used vaping to quit smoking and no longer vape"> I used vaping to quit smoking and no longer vape</label>
              <label><input type="radio" name="use_profile" value="I do not currently vape or smoke"> I do not currently vape or smoke</label>
            </div>
          </fieldset>
        </div>

        <!-- STEP 3 -->
        <div class="step" data-step="3">
          <fieldset>
            <legend>Knowledge & Skills <span class="req">*</span></legend>
            <p class="hint">Although not required, knowledge of products and skills such as working with rebuildables are advantageous. Describe any relevant knowledge or skills. If none, simply write “None”.</p>
            <textarea id="skills_knowledge" name="skills_knowledge" rows="4" required placeholder="e.g., coil building, Ohm's law basics, disposables troubleshooting, POS experience"></textarea>
          </fieldset>

          <fieldset>
            <legend>Prior Vape Industry Experience</legend>
            <p class="hint">Do you have any prior experience working in the vape industry? If so, for how long, and where?</p>
            <textarea id="vape_experience" name="vape_experience" rows="4" placeholder="e.g., 1 year at XYZ Vape — sales & inventory"></textarea>
          </fieldset>

          <fieldset>
            <legend>Extra</legend>
            <label for="why_here">Why do you want to work here?</label>
            <textarea id="why_here" name="why_here" rows="3"></textarea>
            <label for="referred_by">Were you referred by someone?</label>
            <input type="text" id="referred_by" name="referred_by" placeholder="Employee name, friend, or N/A">
          </fieldset>
        </div>

        <div class="actions">
          <div class="status" id="status"></div>
          <div class="actions-right">
            <button type="button" class="btn ghost" id="prevBtn" disabled>Back</button>
            <button type="button" class="btn primary" id="nextBtn">Next</button>
            <button type="submit" class="btn primary" id="submitBtn" style="display:none;">Submit Application</button>
          </div>
        </div>
      </form>
    </div>
  </section>

  <section class="card" id="successCard" style="display:none;">
    <div class="bar"></div>
    <div class="success">
      <h2>Application received 🎉</h2>
      <p>Thanks for applying! We’ll review your application and reach out if there’s a fit.</p>
      <p class="hint">We’ll securely store your application for up to six months.</p>
    </div>
  </section>
</main>

<footer>© <span id="yr"></span> Cloud 9 Vapes / The Hemp and Kratom Depot</footer>

<script>
const EMAILJS_PUBLIC_KEY   = "kf8Acdv6yrSNa_AaH";
const EMAILJS_SERVICE_ID   = "service_2fr4mdc";
const EMAILJS_TEMPLATE_ID  = "template_a4e1928";
const GAS_URL              = "https://script.google.com/macros/s/AKfycbxFUNzKCjxcTe4WPdNbbPilvHw04fCu0cJ7Y1T4Q-lUq4lOJgWSmm51Qf1S5Yux4dPa0Q/exec";
const RECAPTCHA_SITE_KEY   = "6LeMDbsrAAAAAKpwpF8t9Rjua34eDicplvmxS1fo";
const EMAILJS_AUTOREPLY_TEMPLATE_ID = "";

const THEMES = {
  "Cloud 9 Vapes": {
    accent:"#2563eb", accent2:"#60a5fa", soft:"rgba(37,99,235,.12)",
    cardTint:"#f6f9ff", bgA:"#f7fbff", bgB:"#eef5ff",
    s1:"rgba(37,99,235,.10)", s2:"rgba(96,165,250,.08)",
    logo:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MDAiIGhlaWdodD0iMjgwIj4KICA8ZGVmcz4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iZyIgeDE9IjAiIHkxPSIwIiB4Mj0iMSIgeTI9IjEiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiMyNTYzZWIiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjNjBhNWZhIi8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPGZpbHRlciBpZD0ic2hhZG93IiB4PSItMjAlIiB5PSItMjAlIiB3aWR0aD0iMTQwJSIgaGVpZ2h0PSIxNDAlIj4KICAgICAgPGZlRHJvcFNoYWRvdyBkeD0iMCIgZHk9IjYiIHN0ZERldmlhdGlvbj0iNiIgZmxvb2QtY29sb3I9IiMwMDAiIGZsb29kLW9wYWNpdHk9Ii4yIi8+CiAgICA8L2ZpbHRlcj4KICA8L2RlZnM+CiAgPHJlY3QgeD0iMTIiIHk9IjEyIiB3aWR0aD0iODc2IiBoZWlnaHQ9IjI1NiIgcng9IjI0IiBmaWxsPSJ1cmwoI2cpIiBmaWx0ZXI9InVybCgjc2hhZG93KSIvPgogIDx0ZXh0IHg9IjUwJSIgeT0iNDglIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iSW50ZXIsU2Vnb2UgVUksQXJpYWwiIGZvbnQtd2VpZ2h0PSI4MDAiIGZvbnQtc2l6ZT0iNjgiIGZpbGw9IiNmZmYiPkNsb3VkIDkgVmFwZXM8L3RleHQ+CiAgPHRleHQgeD0iNTAlIiB5PSI3NiUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJJbnRlcixTZWdvZSBVSSxBcmlhbCIgZm9udC13ZWlnaHQ9IjYwMCIgZm9udC1zaXplPSIzOCIgZmlsbD0iI2U4ZjFmZiI+QXBwbHkgTm93PC90ZXh0Pgo8L3N2Zz4="
  },
  "The Hemp and Kratom Depot": {
    accent:"#16a34a", accent2:"#34d399", soft:"rgba(16,185,129,.14)",
    cardTint:"#f6fef9", bgA:"#f7fdf9", bgB:"#eefcf4",
    s1:"rgba(20,184,166,.10)", s2:"rgba(34,197,94,.08)",
    logo:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MDAiIGhlaWdodD0iMjgwIj4KICA8ZGVmcz4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iZyIgeDE9IjAiIHkxPSIwIiB4Mj0iMSIgeTI9IjEiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiMxNmEzNGEiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjMzRkMzk5Ii8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPGZpbHRlciBpZD0ic2hhZG93IiB4PSItMjAlIiB5PSItMjAlIiB3aWR0aD0iMTQwJSIgaGVpZ2h0PSIxNDAlIj4KICAgICAgPGZlRHJvcFNoYWRvdyBkeD0iMCIgZHk9IjYiIHN0ZERldmlhdGlvbj0iNiIgZmxvb2QtY29sb3I9IiMwMDAiIGZsb29kLW9wYWNpdHk9Ii4yIi8+CiAgICA8L2ZpbHRlcj4KICA8L2RlZnM+CiAgPHJlY3QgeD0iMTIiIHk9IjEyIiB3aWR0aD0iODc2IiBoZWlnaHQ9IjI1NiIgcng9IjI0IiBmaWxsPSJ1cmwoI2cpIiBmaWx0ZXI9InVybCgjc2hhZG93KSIvPgogIDx0ZXh0IHg9IjUwJSIgeT0iNDglIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iSW50ZXIsU2Vnb2UgVUksQXJpYWwiIGZvbnQtd2VpZ2h0PSI4MDAiIGZvbnQtc2l6ZT0iNjgiIGZpbGw9IiNmZmYiPlRoZSBIZW1wICYgS3JhdG9tIERlcG90PC90ZXh0PgogIDx0ZXh0IHg9IjUwJSIgeT0iNzYlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iSW50ZXIsU2Vnb2UgVUksQXJpYWwiIGZvbnQtd2VpZ2h0PSI2MDAiIGZvbnQtc2l6ZT0iMzgiIGZpbGw9IiNlOGYxZmYiPkFwcGx5IE5vdzwvdGV4dD4KPC9zdmc+"
  }
};

const COMPANY_LOCATIONS = {
  "Cloud 9 Vapes": [
    "2315 Hillcrest Rd - Mobile, AL 36695 Open 24/7",
    "3913 Airport Blvd - Mobile, AL 36608",
    "7885 Moffett Rd - Semmes, AL 36575",
    "27080 Hwy 98 - Daphne, AL 36526 Open 24/7",
    "3586 Sangani Blvd - D'Iberville, MS 39540 24/7",
    "29 Shell St - Saraland, AL 36571 Soon To Be 24/7",
    "4439 Rangeline Rd - Tillman’s Corner"
  ],
  "The Hemp and Kratom Depot": ["3506 Main St, Moss Point, MS 39563"]
};

let startedAt = Date.now();
const $ = (sel) => document.querySelector(sel);
const $$ = (sel) => Array.from(document.querySelectorAll(sel));
const progressBar = $("#progressBar");
const steps = $$(".step");
let currentStep = 1;

function setTheme(company){
  const t = THEMES[company] || THEMES["Cloud 9 Vapes"];
  const root = document.documentElement;
  root.style.setProperty('--accent', t.accent);
  root.style.setProperty('--accent-2', t.accent2);
  root.style.setProperty('--accent-soft', t.soft);
  root.style.setProperty('--card-tint', t.cardTint);
  root.style.setProperty('--bg-a', t.bgA);
  root.style.setProperty('--bg-b', t.bgB);
  root.style.setProperty('--bg-splotch-1', t.s1);
  root.style.setProperty('--bg-splotch-2', t.s2);
  $("#brandLogo").src = t.logo;
}

function renderLocations(company){
  const container = $("#locationsContainer");
  container.innerHTML = '';
  const list = COMPANY_LOCATIONS[company] || [];
  if(!company){
    container.innerHTML = '<p class="hint">Select a company to choose a location.</p>';
    return;
  }
  const frag = document.createDocumentFragment();
  list.forEach(addr => {
    const label = document.createElement('label');
    const input = document.createElement('input');
    input.type = 'checkbox'; input.name = 'locations'; input.value = addr;
    label.appendChild(input); label.appendChild(document.createTextNode(' ' + addr));
    frag.appendChild(label);
  });
  container.appendChild(frag);
  const hint = document.createElement('div'); hint.className='hint'; hint.textContent='Pick at least one.';
  container.appendChild(hint);
}

function showStep(n){
  steps.forEach(el => el.classList.toggle('active', Number(el.dataset.step)===n));
  $("#prevBtn").disabled = (n===1);
  $("#nextBtn").style.display = (n<3) ? 'inline-block' : 'none';
  $("#submitBtn").style.display = (n===3) ? 'inline-block' : 'none';
  progressBar.style.width = (n*33) + '%';
  currentStep = n;
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function validateStep(n){
  const stepEl = document.querySelector('.step[data-step="'+n+'"]');
  const required = stepEl.querySelectorAll('[required]');
  for (const el of required){
    if ((el.type==='radio' || el.type==='checkbox')) {
      const checked = stepEl.querySelector('[name="'+el.name+'"]:checked');
      if (!checked) return false;
    } else {
      if (!el.value) return false;
    }
  }
  if (n===1){
    const locs = $$('#locationsContainer input[name="locations"]:checked');
    if (!locs.length) return false;
    const birthdate = $("#birthdate").value;
    const age = calcAgeYears(birthdate);
    if (!birthdate || age < 21) return false;
  }
  return true;
}

function getRadio(name){ return (document.querySelector('input[name="'+name+'"]:checked')||{}).value || ''; }
function getLocations(){ return $$('#locationsContainer input[name="locations"]:checked').map(cb => cb.value).join(', '); }
function calcAgeYears(isoDate){
  const d = new Date(isoDate); if(isNaN(d)) return 0; const t=new Date();
  let a = t.getFullYear()-d.getFullYear(); const m=t.getMonth()-d.getMonth();
  if(m<0 || (m===0 && t.getDate()<d.getDate())) a--;
  return a;
}
function getVal(id){ const el = document.getElementById(id); return el ? el.value : ''; }

async function getRecaptchaToken(){
  try {
    if (!window.grecaptcha || !RECAPTCHA_SITE_KEY) return '';
    await grecaptcha.ready(() => {});
    const token = await grecaptcha.execute(RECAPTCHA_SITE_KEY, {action:'apply'});
    return token || '';
  } catch(e) { return ''; }
}

document.addEventListener('DOMContentLoaded', () => {
  emailjs.init({ publicKey: EMAILJS_PUBLIC_KEY });
  document.getElementById('yr').textContent = new Date().getFullYear();

  const dob = document.getElementById('birthdate');
  if(dob){
    const t = new Date();
    const max = new Date(t.getFullYear()-21, t.getMonth(), t.getDate());
    const pad = n => String(n).padStart(2,'0');
    dob.max = max.getFullYear() + '-' + pad(max.getMonth()+1) + '-' + pad(max.getDate());
  }

  setTheme('Cloud 9 Vapes'); renderLocations('Cloud 9 Vapes');

  document.getElementById('company').addEventListener('change', (e) => {
    setTheme(e.target.value); renderLocations(e.target.value);
  });

  const hp = document.getElementById('hp'); if(hp) hp.value='';

  (function preselectFromURL(){
    const params = new URLSearchParams(location.search);
    const c = params.get('company');
    const loc = params.get('location');
    if (c) { document.getElementById('company').value = c; document.getElementById('company').dispatchEvent(new Event('change')); }
    if (loc) {
      setTimeout(() => {
        document.querySelectorAll('#locationsContainer input[name="locations"]').forEach(cb => {
          if (cb.value.toLowerCase().includes(loc.toLowerCase())) cb.checked = true;
        });
      }, 120);
    }
  })();

  document.getElementById('nextBtn').addEventListener('click', () => {
    if (!validateStep(currentStep)) { alert('Please complete required fields on this step.'); return; }
    showStep(Math.min(3, currentStep+1));
  });
  document.getElementById('prevBtn').addEventListener('click', () => showStep(Math.max(1, currentStep-1)));
  showStep(1);
});

const form = document.getElementById('applicationForm');
const statusEl = document.getElementById('status');
const successCard = document.getElementById('successCard');
const formCard = document.getElementById('formCard');

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  if (!validateStep(1) || !validateStep(2) || !validateStep(3)) { alert('Please finish all required fields first.'); return; }
  if (document.getElementById('hp').value) { statusEl.textContent = "Submission blocked."; return; }

  const fd = new FormData();
  fd.append('company', getVal('company'));
  fd.append('locations', getLocations());
  fd.append('first_name', getVal('first_name'));
  fd.append('last_name', getVal('last_name'));
  fd.append('email', getVal('email'));
  fd.append('phone', getVal('phone'));
  fd.append('position', getVal('position'));
  fd.append('birthdate', getVal('birthdate'));
  fd.append('age', String(calcAgeYears(getVal('birthdate'))));
  fd.append('start_date', getVal('start_date'));
  fd.append('position_type', getRadio('position_type'));
  fd.append('availability_limits', getVal('availability_limits'));
  fd.append('use_profile', getRadio('use_profile'));
  fd.append('skills_knowledge', getVal('skills_knowledge'));
  fd.append('vape_experience', getVal('vape_experience'));
  fd.append('why_here', getVal('why_here'));
  fd.append('referred_by', getVal('referred_by'));
  fd.append('seconds_spent', String(Math.round((Date.now() - startedAt)/1000)));

  const token = await getRecaptchaToken();
  if (token) fd.append('recaptcha_token', token);

  try {
    statusEl.textContent = 'Submitting…';
    document.getElementById('submitBtn').disabled = true;
    document.getElementById('nextBtn').disabled = true;
    document.getElementById('prevBtn').disabled = true;

    const resp = await fetch(GAS_URL, { method: 'POST', body: fd });
    const data = await resp.json();
    if (!data.ok) throw new Error(data.error || 'Submission failed');

    const params = {
      company: getVal('company'),
      locations: getLocations(),
      first_name: getVal('first_name'),
      last_name: getVal('last_name'),
      email: getVal('email'),
      phone: getVal('phone'),
      position: getVal('position'),
      birthdate: getVal('birthdate'),
      age: String(calcAgeYears(getVal('birthdate'))),
      start_date: getVal('start_date'),
      position_type: getRadio('position_type'),
      availability_limits: getVal('availability_limits'),
      use_profile: getRadio('use_profile'),
      skills_knowledge: getVal('skills_knowledge'),
      vape_experience: getVal('vape_experience'),
      why_here: getVal('why_here'),
      referred_by: getVal('referred_by')
    };

    statusEl.textContent = 'Sending email…';
    await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, params);

    statusEl.textContent = '✅ Application sent successfully!';
    form.reset(); startedAt = Date.now();
    setTheme('Cloud 9 Vapes'); renderLocations('Cloud 9 Vapes');
    showStep(1);
    formCard.style.display = 'none';
    successCard.style.display = 'block';
    window.scrollTo({ top: 0, behavior: 'smooth' });
  } catch (err) {
    console.error(err);
    statusEl.textContent = '❌ Failed: ' + err.message;
  } finally {
    document.getElementById('submitBtn').disabled = false;
    document.getElementById('nextBtn').disabled = false;
    document.getElementById('prevBtn').disabled = (currentStep===1);
  }
});
</script>
</body>
</html>
